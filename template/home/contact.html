<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
{% load static %}

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/docs/4.0/assets/img/favicons/favicon.ico">

    <title>BGP Stream</title>
    <!-- Bootstrap core CSS -->
    <link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/dashboard/">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
        integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">

    <!-- Custom styles for this template -->
    <link href="{% static 'css/dashboard.css' %}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>

</head>
<style>
    #container {
        min-width: 310px;
        max-width: 1200px;
        height: 600px;
        margin: 0 auto;
    }
</style>

<body>
    {% include 'layout/navbar.html' %}


    <main role="main" class=" container col-md-12 ml-sm-auto col-lg-12 pt-3 px-4">
        <div class="container">
            <div class="py-5 text-center">
            <h2>Contact Us</h2>
              <p class="lead">Below is an example form built entirely with Bootstrap's form controls. Each required form group has a validation state that can be triggered by attempting to submit the form without completing it.</p>
            </div>
      
            <div class="row">

              <div class="col-md-12 order-md-1">
                <h4 class="mb-3">Billing address</h4>
                <form class="needs-validation" novalidate="">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="firstName">First name</label>
                      <input type="text" class="form-control" id="firstName" placeholder="" value="" required="">
                      <div class="invalid-feedback">
                        Valid first name is required.
                      </div>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="lastName">Last name</label>
                      <input type="text" class="form-control" id="lastName" placeholder="" value="" required="">
                      <div class="invalid-feedback">
                        Valid last name is required.
                      </div>
                    </div>
                  </div>
      
                  <div class="mb-3">
                    <label for="username">Username</label>
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">@</span>
                      </div>
                      <input type="text" class="form-control" id="username" placeholder="Username" required="">
                      <div class="invalid-feedback" style="width: 100%;">
                        Your username is required.
                      </div>
                    </div>
                  </div>
                
                  <hr class="mb-4">
                  <button class="btn btn-primary btn-lg btn-block" type="submit">Submit</button>
                </form>
              </div>
            </div>
      
            <footer class="my-5 pt-5 text-muted text-center text-small">
              <p class="mb-1">Â© 2022 BGP RealTime</p>
              
            </footer>
          </div>
    </main>
    <script src="{% static 'js/socket_script.js' %}"></script>
    <!-- Bootstrap core JavaScript
================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="{%  static 'js / vendor / jquery - slim.min.js' %}"><\/script>')</script>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
        crossorigin="anonymous"></script>
    <!-- Icons -->
    <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
    <script>
        feather.replace()
    </script>

    <!-- Graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.7.1/dist/Chart.min.js"></script>
    <script>
        var ctx = document.getElementById("myChart");
        var myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
                datasets: [{
                    data: [15339, 21345, 18483, 24003, 23489, 24092, 12034],
                    lineTension: 0,
                    backgroundColor: 'transparent',
                    borderColor: '#007bff',
                    borderWidth: 4,
                    pointBackgroundColor: '#007bff'
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: false
                        }
                    }]
                },
                legend: {
                    display: false,
                }
            }
        });
    </script>
    <script>

        var options2 = {
            series: [],
            chart: {
                type: 'bar',
                height: 350,
            },
            xaxis: {
                type: 'category',
            },
            title: {
                text: 'Grouped Labels on the X-axis',
            },
        };

        var chart2 = new ApexCharts(document.querySelector("#chart2"), options2);
        chart2.render();
        var chart4 = new ApexCharts(document.querySelector("#chart4"), options2);
        chart4.render();


    </script>
    <script>
        "use strict";
        let user_id = null
        let dateSeries = []
        let lineSeriesOne = []
        let lineSeriesTwo = []
        let seriesTwo = []
        let seriesThree = []
        let seriesFour = []
        let chartLineSeriesOne = []
        let chartLineSeriesTwo = []

        var options = {
            series: [],
            chart: {
                id: 'realtime',
                height: 350,
                type: 'line',
                animations: {
                    enabled: true,
                    easing: 'linear',
                    dynamicAnimation: {
                        speed: 1000
                    }
                },
                toolbar: {
                    show: false
                },
                zoom: {
                    enabled: false
                }
            },
            colors: ['#018ffa', '#68e496'],
            dataLabels: {
                enabled: false,
            },
            stroke: {
                curve: 'smooth'
            },
            title: {
                text: 'Dynamic Updating Chart',
                align: 'left'
            },
            markers: {
                size: 0
            },
            xaxis: {
                type: 'categories',
            },
            yaxis: {
                max: undefined
            },
            legend: {
                show: false
            },
        };

        var chart = new ApexCharts(document.querySelector("#chart"), options);
        var chart3 = new ApexCharts(document.querySelector("#chart3"), options);
        chart3.render();
        chart.render();
        try {
            console.log("hey bgp")
            const socket = new WebSocket('ws://127.0.0.1:8000/ws/11')
            socket.onmessage = function (event) {
                var resp = event['data']
                var myObj = JSON.parse(resp);

            }
            /* Listen for messages */
            socket.addEventListener('message', function (event) {
                var newObj = JSON.parse(event.data)
                if (newObj) {
                    console.log(newObj)
                    dateSeries.push(newObj.date_range)
                    let new_date = DateFormate(new Date())
                    lineSeriesOne.push(
                        {
                            x: newObj.date_range,
                            y: newObj.data.first_graph.distinct
                        }
                    )
                    lineSeriesTwo.push({
                        x: newObj.date_range,
                        y: newObj.data.first_graph.total + 2
                    })
                    chartLineSeriesOne.push({
                        x: newObj.date_range,
                        y: newObj.data.fourth_graph.distinct + 2
                    });
                    chartLineSeriesTwo.push({
                        x: newObj.date_range,
                        y: newObj.data.fourth_graph.total + 2
                    })
                    console.log("new obj", newObj.data)
                    chart2.updateSeries([
                        {
                            name: "sales",
                            data: [
                                newObj.data.second_graph[0],
                                newObj.data.second_graph[1],
                                newObj.data.second_graph[2],

                            ]
                        }
                    ])
                    chart4.updateSeries([
                        {
                            name: "sales",
                            data: [
                                newObj.data.third_graph[0],
                                newObj.data.third_graph[1],
                                newObj.data.third_graph[2],

                            ]
                        }
                    ])
                    chart.updateSeries([
                        {
                            name: "Distinct",
                            data: lineSeriesOne,
                        },
                        {
                            name: "Total",
                            data: lineSeriesTwo,

                        },
                    ]);
                    chart3.updateSeries([
                        {
                            name: "Distinct",
                            data: chartLineSeriesOne,
                        },
                        {
                            name: "Total",
                            data: chartLineSeriesTwo,

                        },
                    ])
                } else {
                    alert('The message was empty!')
                }
            });
            initializeConnection()

            function initializeConnection() {
                socket.addEventListener("open", function (event) {
                    socket.send(JSON.stringify({
                        'search_string': "search_string",
                    }));
                })
            };
            /* send parameter to socket  */


        } catch (e) {
            console.error("Exception", e)
        }
        console.log(dateSeries)
        function DateFormate(date) {

            let dateIs = new Date(date);
            var formatedDate = `${dateIs.getDate()}-${dateIs.getMonth()}-${dateIs.getFullYear()}:${dateIs.getSeconds()}`;
            console.log(formatedDate, date)
            return formatedDate
        }

    </script>

    <!-- Live bar chart with high chart -->
</body>

</html>